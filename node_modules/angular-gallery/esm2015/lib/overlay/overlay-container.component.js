import { __decorate } from "tslib";
import { Component, OnInit, HostBinding, HostListener, ViewChild, ElementRef, Input, ComponentFactoryResolver } from '@angular/core';
import { EventService } from './event.service';
import { AdDirective } from './ad.directive';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './event.service';
import * as ɵngcc2 from './ad.directive';

function OverlayContainerComponent_ng_template_0_Template(rf, ctx) { }
let OverlayContainerComponent = class OverlayContainerComponent {
    constructor(componentFactoryResolver, elementRef, eventService) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.elementRef = elementRef;
        this.eventService = eventService;
        this.overlayBackdrop = true;
        this.minTimeout = 30;
        this._hostOpacity = 0;
        this.globalEventsSubscription = this.eventService.emitter.subscribe((event) => {
            this.handleGlobalEvents(event);
        });
    }
    get hostOpacity() {
        return this.properties.fadeIn ? this._hostOpacity : 1;
    }
    set hostOpacity(value) {
        this._hostOpacity = value;
    }
    get hostTransition() {
        const duration = this.properties.animationDuration + 'ms ';
        const esing = this.properties.animationTimingFunction;
        return 'opacity ' + duration + esing + ', transform ' + duration + esing;
    }
    get hostZIndex() {
        return this.properties.zIndex;
    }
    get hostWidth() {
        return this.properties.wrapperWidth;
    }
    get hostHeight() {
        return this.properties.wrapperHeight;
    }
    get hostPosition() {
        return this.properties.position;
    }
    onClick(event) {
        if (!this.elementRef.nativeElement.contains(event.target)) {
            if (this.hostShown) {
                this.closeOverlay();
            }
        }
    }
    transitionEnd(event) {
        if (event.target.tagName.toLowerCase() != "overlay") {
            return;
        }
        if (event.propertyName != "opacity") {
            return;
        }
        if (this.hostShown) {
            this.closeOverlayEnd();
            //this.stateEvents.emit("shown");
        }
        else {
            this.hostShown = true;
            //this.stateEvents.emit("hidden");
        }
    }
    get popoverClass() {
        if (this.properties.metadata) {
            return this.properties.metadata.popoverClass;
        }
    }
    ngOnInit() {
        this.loadComponent();
        this.initialOverlay();
        setTimeout(() => {
            this.isInitial = true;
        }, this.minTimeout); // Note: not good
    }
    ngAfterViewInit() {
        setTimeout(() => {
            this.showOverlayAnimation();
        }, this.minTimeout);
    }
    ngOnDestroy() {
        if (this.globalEventsSubscription) {
            this.globalEventsSubscription.unsubscribe();
        }
    }
    initialOverlay() {
        this.hostTransform = 'translateY(' + this.properties.animationTranslateY + ')';
    }
    showOverlayAnimation() {
        this.hostOpacity = 1;
        this.hostTransform = 'translateY(0px)';
    }
    loadComponent() {
        let adItem = this.properties;
        let componentFactory = this.componentFactoryResolver.resolveComponentFactory(adItem.mainComponent);
        let viewContainerRef = this.adHost.viewContainerRef;
        viewContainerRef.clear();
        let componentRef = viewContainerRef.createComponent(componentFactory);
        let componentRefElement = componentRef.location.nativeElement;
        // Set styles
        componentRefElement.style.width = this.properties.width;
        componentRefElement.style.height = this.properties.height;
        // Set classes
        if (typeof this.popoverClass === 'string') {
            componentRefElement.classList.add(this.popoverClass);
        }
        if (typeof this.popoverClass === 'object') {
            this.popoverClass.forEach(function (className) {
                componentRefElement.classList.add(className);
            });
        }
        // Pass properties
        componentRef.instance.overlayProperties = this.properties;
    }
    closeOverlay() {
        this.hostOpacity = 0;
        this.hostTransform = 'translateY(' + this.properties.animationTranslateY + ')';
    }
    closeOverlayEnd() {
        this.hostShown = false;
        this.eventService.emitChangeEvent({
            type: '[Overlay] Hide'
        });
    }
    handleGlobalEvents(event) {
        if (event.type === 'Hide') {
            this.closeOverlay();
        }
    }
};
OverlayContainerComponent.ɵfac = function OverlayContainerComponent_Factory(t) { return new (t || OverlayContainerComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.EventService)); };
OverlayContainerComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: OverlayContainerComponent, selectors: [["overlay"]], viewQuery: function OverlayContainerComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵstaticViewQuery(AdDirective, true);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.adHost = _t.first);
    } }, hostVars: 16, hostBindings: function OverlayContainerComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function OverlayContainerComponent_click_HostBindingHandler($event) { return ctx.onClick($event); }, false, ɵngcc0.ɵɵresolveDocument)("transitionend", function OverlayContainerComponent_transitionend_HostBindingHandler($event) { return ctx.transitionEnd($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵstyleProp("opacity", ctx.hostOpacity)("transition", ctx.hostTransition)("z-index", ctx.hostZIndex)("width", ctx.hostWidth)("height", ctx.hostHeight)("position", ctx.hostPosition)("transform", ctx.hostTransform);
        ɵngcc0.ɵɵclassProp("overlay-shown", ctx.hostShown);
    } }, inputs: { properties: "properties" }, decls: 1, vars: 0, consts: [["ad-host", ""]], template: function OverlayContainerComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, OverlayContainerComponent_ng_template_0_Template, 0, 0, "ng-template", 0);
    } }, directives: [ɵngcc2.AdDirective], styles: ["[_nghost-%COMP%]{position:absolute;top:0;left:0}[_nghost-%COMP%]   .overlay-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:#000;opacity:0;z-index:1000;pointer-events:auto}"] });
OverlayContainerComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: ElementRef },
    { type: EventService }
];
__decorate([
    ViewChild(AdDirective, { static: true })
], OverlayContainerComponent.prototype, "adHost", void 0);
__decorate([
    Input()
], OverlayContainerComponent.prototype, "properties", void 0);
__decorate([
    HostBinding('style.opacity')
], OverlayContainerComponent.prototype, "hostOpacity", null);
__decorate([
    HostBinding('style.transition')
], OverlayContainerComponent.prototype, "hostTransition", null);
__decorate([
    HostBinding('style.transform')
], OverlayContainerComponent.prototype, "hostTransform", void 0);
__decorate([
    HostBinding('style.z-index')
], OverlayContainerComponent.prototype, "hostZIndex", null);
__decorate([
    HostBinding('style.width')
], OverlayContainerComponent.prototype, "hostWidth", null);
__decorate([
    HostBinding('style.height')
], OverlayContainerComponent.prototype, "hostHeight", null);
__decorate([
    HostBinding('style.position')
], OverlayContainerComponent.prototype, "hostPosition", null);
__decorate([
    HostBinding('class.overlay-shown')
], OverlayContainerComponent.prototype, "hostShown", void 0);
__decorate([
    HostListener('document:click', ['$event'])
], OverlayContainerComponent.prototype, "onClick", null);
__decorate([
    HostListener('transitionend', ['$event'])
], OverlayContainerComponent.prototype, "transitionEnd", null);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(OverlayContainerComponent, [{
        type: Component,
        args: [{
                selector: 'overlay',
                template: "<!--\n<div class=\"overlay-backdrop\" \n\t*ngIf=\"properties.overlayBackdrop\" \n\t(click)=\"onBackdropClick()\" \n\t[ngClass]=\"properties.backdropClass\"></div>\n-->\n<!--\n<div class=\"overlay-container\"\n\t[ngStyle]=\"containerStyles\" \n\t[ngClass]=\"properties.overlayClass\">\n\n\t<ng-template ad-host></ng-template>\n</div>\n-->\n\n<ng-template ad-host></ng-template>",
                styles: [":host{position:absolute;top:0;left:0}:host .overlay-backdrop{position:fixed;top:0;left:0;right:0;bottom:0;background-color:#000;opacity:0;z-index:1000;pointer-events:auto}"]
            }]
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: ɵngcc0.ElementRef }, { type: ɵngcc1.EventService }]; }, { hostOpacity: [{
            type: HostBinding,
            args: ['style.opacity']
        }], hostTransition: [{
            type: HostBinding,
            args: ['style.transition']
        }], hostZIndex: [{
            type: HostBinding,
            args: ['style.z-index']
        }], hostWidth: [{
            type: HostBinding,
            args: ['style.width']
        }], hostHeight: [{
            type: HostBinding,
            args: ['style.height']
        }], hostPosition: [{
            type: HostBinding,
            args: ['style.position']
        }], onClick: [{
            type: HostListener,
            args: ['document:click', ['$event']]
        }], transitionEnd: [{
            type: HostListener,
            args: ['transitionend', ['$event']]
        }], hostShown: [{
            type: HostBinding,
            args: ['class.overlay-shown']
        }], hostTransform: [{
            type: HostBinding,
            args: ['style.transform']
        }], adHost: [{
            type: ViewChild,
            args: [AdDirective, { static: true }]
        }], properties: [{
            type: Input
        }] }); })();
export { OverlayContainerComponent };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3ZlcmxheS1jb250YWluZXIuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyJhbmd1bGFyLWdhbGxlcnkvbGliL292ZXJsYXkvb3ZlcmxheS1jb250YWluZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLHdCQUF3QixFQUM1RyxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7QUFTN0MsSUFBYSx5QkFBeUIsR0FBdEMsTUFBYSx5QkFBeUI7QUFBSSxJQWtGdEMsWUFDWSx3QkFBa0QsRUFDbkQsVUFBc0IsRUFDckIsWUFBMEI7QUFDekMsUUFIZSw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO0FBQ2xFLFFBQWUsZUFBVSxHQUFWLFVBQVUsQ0FBWTtBQUNyQyxRQUFnQixpQkFBWSxHQUFaLFlBQVksQ0FBYztBQUFFLFFBbEZqQyxvQkFBZSxHQUFZLElBQUksQ0FBQztBQUMxQyxRQUFHLGVBQVUsR0FBVyxFQUFFLENBQUM7QUFDM0IsUUFBRyxpQkFBWSxHQUFXLENBQUMsQ0FBQztBQUU3QixRQStFUSxJQUFJLENBQUMsd0JBQXdCLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUMvRCxDQUFDLEtBQUssRUFBRSxFQUFFO0FBQ3JCLFlBQWUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzlDLFFBQVcsQ0FBQyxDQUNKLENBQUM7QUFDVCxJQUFHLENBQUM7QUFFTCxJQWpGSSxJQUFJLFdBQVc7QUFDakIsUUFBTSxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJ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LEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFTQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFrRkEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFGQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFsRkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBaUZBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBL0VBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUlBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBS0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQWFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFyRkEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBOUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBREEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBTUEsQUFEQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBS0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBREEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBR0EsQUFEQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFFQSxBQURBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUdBLEFBREEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQURBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQU9BLEFBR0EsQUFEQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFpQkEsQUExRUEsQUFBQSxBQU5BLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFFQSxBQUFBLEFBd0tBLEFBeEtBLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSG9zdEJpbmRpbmcsIEhvc3RMaXN0ZW5lciwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBJbnB1dCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRXZlbnRTZXJ2aWNlIH0gZnJvbSAnLi9ldmVudC5zZXJ2aWNlJztcbmltcG9ydCB7IEFkRGlyZWN0aXZlIH0gZnJvbSAnLi9hZC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgQ29tcG9uZW50UHJvcGVydGllcywgT3ZlcmxheVByb3BlcnRpZXMgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ292ZXJsYXknLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9vdmVybGF5LWNvbnRhaW5lci5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vb3ZlcmxheS1jb250YWluZXIuY29tcG9uZW50LnNhc3MnXVxufSlcblxuZXhwb3J0IGNsYXNzIE92ZXJsYXlDb250YWluZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgIHB1YmxpYyBpc0luaXRpYWw6IGJvb2xlYW47XG4gICAgZ2xvYmFsRXZlbnRzU3Vic2NyaXB0aW9uO1xuICAgIHB1YmxpYyBvdmVybGF5QmFja2Ryb3A6IGJvb2xlYW4gPSB0cnVlO1xuICAgIG1pblRpbWVvdXQ6IG51bWJlciA9IDMwO1xuICAgIF9ob3N0T3BhY2l0eTogbnVtYmVyID0gMDtcblxuICAgIEBWaWV3Q2hpbGQoQWREaXJlY3RpdmUsIHtzdGF0aWM6IHRydWV9KSBhZEhvc3Q6IEFkRGlyZWN0aXZlO1xuXG4gICAgQElucHV0KCkgcHJvcGVydGllczogT3ZlcmxheVByb3BlcnRpZXM7XG5cbiAgICBASG9zdEJpbmRpbmcoJ3N0eWxlLm9wYWNpdHknKVxuICAgIGdldCBob3N0T3BhY2l0eSgpe1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmZhZGVJbiA/IHRoaXMuX2hvc3RPcGFjaXR5IDogMTtcbiAgICB9XG4gICAgc2V0IGhvc3RPcGFjaXR5KHZhbHVlKXtcbiAgICAgICAgdGhpcy5faG9zdE9wYWNpdHkgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBASG9zdEJpbmRpbmcoJ3N0eWxlLnRyYW5zaXRpb24nKVxuICAgIGdldCBob3N0VHJhbnNpdGlvbigpe1xuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IHRoaXMucHJvcGVydGllcy5hbmltYXRpb25EdXJhdGlvbisnbXMgJztcbiAgICAgICAgY29uc3QgZXNpbmcgPSB0aGlzLnByb3BlcnRpZXMuYW5pbWF0aW9uVGltaW5nRnVuY3Rpb247XG4gICAgICAgIHJldHVybiAnb3BhY2l0eSAnKyBkdXJhdGlvbiArIGVzaW5nICsgJywgdHJhbnNmb3JtICcrIGR1cmF0aW9uICsgZXNpbmc7XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdzdHlsZS50cmFuc2Zvcm0nKSBob3N0VHJhbnNmb3JtOiBzdHJpbmc7XG4gICAgQEhvc3RCaW5kaW5nKCdzdHlsZS56LWluZGV4JykgXG4gICAgZ2V0IGhvc3RaSW5kZXgoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy56SW5kZXg7XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdzdHlsZS53aWR0aCcpIFxuICAgIGdldCBob3N0V2lkdGgoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy53cmFwcGVyV2lkdGg7XG4gICAgfVxuICAgIEBIb3N0QmluZGluZygnc3R5bGUuaGVpZ2h0JykgXG4gICAgZ2V0IGhvc3RIZWlnaHQoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy53cmFwcGVySGVpZ2h0O1xuICAgIH1cblxuICAgIEBIb3N0QmluZGluZygnc3R5bGUucG9zaXRpb24nKSBcbiAgICBnZXQgaG9zdFBvc2l0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMucG9zaXRpb247XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5vdmVybGF5LXNob3duJykgaG9zdFNob3duOiBib29sZWFuO1xuXG4gICAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6Y2xpY2snLCBbJyRldmVudCddKVxuICAgIG9uQ2xpY2soZXZlbnQpe1xuICAgICAgICBpZiAoIXRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmhvc3RTaG93bil7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZU92ZXJsYXkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCBbJyRldmVudCddKVxuICAgIHRyYW5zaXRpb25FbmQoZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT0gXCJvdmVybGF5XCIpe1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGV2ZW50LnByb3BlcnR5TmFtZSAhPSBcIm9wYWNpdHlcIikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaG9zdFNob3duKSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlT3ZlcmxheUVuZCgpO1xuICAgICAgICAgICAgLy90aGlzLnN0YXRlRXZlbnRzLmVtaXQoXCJzaG93blwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaG9zdFNob3duID0gdHJ1ZTtcbiAgICAgICAgICAgIC8vdGhpcy5zdGF0ZUV2ZW50cy5lbWl0KFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHBvcG92ZXJDbGFzcygpe1xuICAgICAgICBpZiAodGhpcy5wcm9wZXJ0aWVzLm1ldGFkYXRhKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMubWV0YWRhdGEucG9wb3ZlckNsYXNzO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgICAgIHB1YmxpYyBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgICAgICBwcml2YXRlIGV2ZW50U2VydmljZTogRXZlbnRTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZ2xvYmFsRXZlbnRzU3Vic2NyaXB0aW9uID0gdGhpcy5ldmVudFNlcnZpY2UuZW1pdHRlci5zdWJzY3JpYmUoXG4gICAgICAgICAgICAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUdsb2JhbEV2ZW50cyhldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMubG9hZENvbXBvbmVudCgpO1xuICAgICAgICB0aGlzLmluaXRpYWxPdmVybGF5KCk7XG5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzSW5pdGlhbCA9IHRydWU7XG4gICAgICAgIH0sIHRoaXMubWluVGltZW91dCk7IC8vIE5vdGU6IG5vdCBnb29kXG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2hvd092ZXJsYXlBbmltYXRpb24oKTtcbiAgICAgICAgfSwgdGhpcy5taW5UaW1lb3V0KTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZ2xvYmFsRXZlbnRzU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmdsb2JhbEV2ZW50c1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdGlhbE92ZXJsYXkoKXtcbiAgICAgICAgdGhpcy5ob3N0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVkoJyt0aGlzLnByb3BlcnRpZXMuYW5pbWF0aW9uVHJhbnNsYXRlWSsnKSc7XG4gICAgfVxuXG4gICAgc2hvd092ZXJsYXlBbmltYXRpb24oKXtcbiAgICAgICAgdGhpcy5ob3N0T3BhY2l0eSA9IDE7XG4gICAgICAgIHRoaXMuaG9zdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKDBweCknO1xuICAgIH1cblxuICAgIGxvYWRDb21wb25lbnQoKSB7XG4gICAgICAgIGxldCBhZEl0ZW0gPSB0aGlzLnByb3BlcnRpZXM7XG4gICAgICAgIGxldCBjb21wb25lbnRGYWN0b3J5ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoYWRJdGVtLm1haW5Db21wb25lbnQpO1xuICAgICAgICBsZXQgdmlld0NvbnRhaW5lclJlZiA9IHRoaXMuYWRIb3N0LnZpZXdDb250YWluZXJSZWY7XG5cbiAgICAgICAgdmlld0NvbnRhaW5lclJlZi5jbGVhcigpO1xuXG4gICAgICAgIGxldCBjb21wb25lbnRSZWYgPSB2aWV3Q29udGFpbmVyUmVmLmNyZWF0ZUNvbXBvbmVudChjb21wb25lbnRGYWN0b3J5KTtcbiAgICAgICAgbGV0IGNvbXBvbmVudFJlZkVsZW1lbnQgPSAoPENvbXBvbmVudFByb3BlcnRpZXM+Y29tcG9uZW50UmVmLmxvY2F0aW9uKS5uYXRpdmVFbGVtZW50O1xuXG4gICAgICAgIC8vIFNldCBzdHlsZXNcbiAgICAgICAgY29tcG9uZW50UmVmRWxlbWVudC5zdHlsZS53aWR0aCA9IHRoaXMucHJvcGVydGllcy53aWR0aDtcbiAgICAgICAgY29tcG9uZW50UmVmRWxlbWVudC5zdHlsZS5oZWlnaHQgPSB0aGlzLnByb3BlcnRpZXMuaGVpZ2h0O1xuXG4gICAgICAgIC8vIFNldCBjbGFzc2VzXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5wb3BvdmVyQ2xhc3MgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBjb21wb25lbnRSZWZFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5wb3BvdmVyQ2xhc3MpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5wb3BvdmVyQ2xhc3MgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aGlzLnBvcG92ZXJDbGFzcy5mb3JFYWNoKGZ1bmN0aW9uKGNsYXNzTmFtZSkge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudFJlZkVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICAgICAgICAgICAgfSk7IFxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUGFzcyBwcm9wZXJ0aWVzXG4gICAgICAgICg8Q29tcG9uZW50UHJvcGVydGllcz5jb21wb25lbnRSZWYuaW5zdGFuY2UpLm92ZXJsYXlQcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzO1xuICAgIH1cblxuICAgIGNsb3NlT3ZlcmxheSgpe1xuICAgICAgICB0aGlzLmhvc3RPcGFjaXR5ID0gMDtcbiAgICAgICAgdGhpcy5ob3N0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVkoJyt0aGlzLnByb3BlcnRpZXMuYW5pbWF0aW9uVHJhbnNsYXRlWSsnKSc7XG4gICAgfVxuXG4gICAgY2xvc2VPdmVybGF5RW5kKCkge1xuICAgICAgICB0aGlzLmhvc3RTaG93biA9IGZhbHNlO1xuICAgICAgICB0aGlzLmV2ZW50U2VydmljZS5lbWl0Q2hhbmdlRXZlbnQoe1xuICAgICAgICAgICAgdHlwZTogJ1tPdmVybGF5XSBIaWRlJ1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBoYW5kbGVHbG9iYWxFdmVudHMoZXZlbnQpe1xuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ0hpZGUnKXtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VPdmVybGF5KCk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=