import { __decorate } from "tslib";
import { Component, OnInit, HostBinding, HostListener, ViewChild, ElementRef, Input, ComponentFactoryResolver } from '@angular/core';
import { EventService } from './event.service';
import { AdDirective } from './ad.directive';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './event.service';
import * as ɵngcc2 from './ad.directive';

function OverlayContainerComponent_ng_template_0_Template(rf, ctx) { }
var OverlayContainerComponent = /** @class */ (function () {
    function OverlayContainerComponent(componentFactoryResolver, elementRef, eventService) {
        var _this = this;
        this.componentFactoryResolver = componentFactoryResolver;
        this.elementRef = elementRef;
        this.eventService = eventService;
        this.overlayBackdrop = true;
        this.minTimeout = 30;
        this._hostOpacity = 0;
        this.globalEventsSubscription = this.eventService.emitter.subscribe(function (event) {
            _this.handleGlobalEvents(event);
        });
    }
    Object.defineProperty(OverlayContainerComponent.prototype, "hostOpacity", {
        get: function () {
            return this.properties.fadeIn ? this._hostOpacity : 1;
        },
        set: function (value) {
            this._hostOpacity = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OverlayContainerComponent.prototype, "hostTransition", {
        get: function () {
            var duration = this.properties.animationDuration + 'ms ';
            var esing = this.properties.animationTimingFunction;
            return 'opacity ' + duration + esing + ', transform ' + duration + esing;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OverlayContainerComponent.prototype, "hostZIndex", {
        get: function () {
            return this.properties.zIndex;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OverlayContainerComponent.prototype, "hostWidth", {
        get: function () {
            return this.properties.wrapperWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OverlayContainerComponent.prototype, "hostHeight", {
        get: function () {
            return this.properties.wrapperHeight;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OverlayContainerComponent.prototype, "hostPosition", {
        get: function () {
            return this.properties.position;
        },
        enumerable: true,
        configurable: true
    });
    OverlayContainerComponent.prototype.onClick = function (event) {
        if (!this.elementRef.nativeElement.contains(event.target)) {
            if (this.hostShown) {
                this.closeOverlay();
            }
        }
    };
    OverlayContainerComponent.prototype.transitionEnd = function (event) {
        if (event.target.tagName.toLowerCase() != "overlay") {
            return;
        }
        if (event.propertyName != "opacity") {
            return;
        }
        if (this.hostShown) {
            this.closeOverlayEnd();
            //this.stateEvents.emit("shown");
        }
        else {
            this.hostShown = true;
            //this.stateEvents.emit("hidden");
        }
    };
    Object.defineProperty(OverlayContainerComponent.prototype, "popoverClass", {
        get: function () {
            if (this.properties.metadata) {
                return this.properties.metadata.popoverClass;
            }
        },
        enumerable: true,
        configurable: true
    });
    OverlayContainerComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.loadComponent();
        this.initialOverlay();
        setTimeout(function () {
            _this.isInitial = true;
        }, this.minTimeout); // Note: not good
    };
    OverlayContainerComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        setTimeout(function () {
            _this.showOverlayAnimation();
        }, this.minTimeout);
    };
    OverlayContainerComponent.prototype.ngOnDestroy = function () {
        if (this.globalEventsSubscription) {
            this.globalEventsSubscription.unsubscribe();
        }
    };
    OverlayContainerComponent.prototype.initialOverlay = function () {
        this.hostTransform = 'translateY(' + this.properties.animationTranslateY + ')';
    };
    OverlayContainerComponent.prototype.showOverlayAnimation = function () {
        this.hostOpacity = 1;
        this.hostTransform = 'translateY(0px)';
    };
    OverlayContainerComponent.prototype.loadComponent = function () {
        var adItem = this.properties;
        var componentFactory = this.componentFactoryResolver.resolveComponentFactory(adItem.mainComponent);
        var viewContainerRef = this.adHost.viewContainerRef;
        viewContainerRef.clear();
        var componentRef = viewContainerRef.createComponent(componentFactory);
        var componentRefElement = componentRef.location.nativeElement;
        // Set styles
        componentRefElement.style.width = this.properties.width;
        componentRefElement.style.height = this.properties.height;
        // Set classes
        if (typeof this.popoverClass === 'string') {
            componentRefElement.classList.add(this.popoverClass);
        }
        if (typeof this.popoverClass === 'object') {
            this.popoverClass.forEach(function (className) {
                componentRefElement.classList.add(className);
            });
        }
        // Pass properties
        componentRef.instance.overlayProperties = this.properties;
    };
    OverlayContainerComponent.prototype.closeOverlay = function () {
        this.hostOpacity = 0;
        this.hostTransform = 'translateY(' + this.properties.animationTranslateY + ')';
    };
    OverlayContainerComponent.prototype.closeOverlayEnd = function () {
        this.hostShown = false;
        this.eventService.emitChangeEvent({
            type: '[Overlay] Hide'
        });
    };
    OverlayContainerComponent.prototype.handleGlobalEvents = function (event) {
        if (event.type === 'Hide') {
            this.closeOverlay();
        }
    };
    OverlayContainerComponent.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: ElementRef },
        { type: EventService }
    ]; };
    __decorate([
        ViewChild(AdDirective, { static: true })
    ], OverlayContainerComponent.prototype, "adHost", void 0);
    __decorate([
        Input()
    ], OverlayContainerComponent.prototype, "properties", void 0);
    __decorate([
        HostBinding('style.opacity')
    ], OverlayContainerComponent.prototype, "hostOpacity", null);
    __decorate([
        HostBinding('style.transition')
    ], OverlayContainerComponent.prototype, "hostTransition", null);
    __decorate([
        HostBinding('style.transform')
    ], OverlayContainerComponent.prototype, "hostTransform", void 0);
    __decorate([
        HostBinding('style.z-index')
    ], OverlayContainerComponent.prototype, "hostZIndex", null);
    __decorate([
        HostBinding('style.width')
    ], OverlayContainerComponent.prototype, "hostWidth", null);
    __decorate([
        HostBinding('style.height')
    ], OverlayContainerComponent.prototype, "hostHeight", null);
    __decorate([
        HostBinding('style.position')
    ], OverlayContainerComponent.prototype, "hostPosition", null);
    __decorate([
        HostBinding('class.overlay-shown')
    ], OverlayContainerComponent.prototype, "hostShown", void 0);
    __decorate([
        HostListener('document:click', ['$event'])
    ], OverlayContainerComponent.prototype, "onClick", null);
    __decorate([
        HostListener('transitionend', ['$event'])
    ], OverlayContainerComponent.prototype, "transitionEnd", null);
OverlayContainerComponent.ɵfac = function OverlayContainerComponent_Factory(t) { return new (t || OverlayContainerComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.EventService)); };
OverlayContainerComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: OverlayContainerComponent, selectors: [["overlay"]], viewQuery: function OverlayContainerComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵstaticViewQuery(AdDirective, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.adHost = _t.first);
    } }, hostVars: 16, hostBindings: function OverlayContainerComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function OverlayContainerComponent_click_HostBindingHandler($event) { return ctx.onClick($event); }, false, ɵngcc0.ɵɵresolveDocument)("transitionend", function OverlayContainerComponent_transitionend_HostBindingHandler($event) { return ctx.transitionEnd($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵstyleProp("opacity", ctx.hostOpacity)("transition", ctx.hostTransition)("z-index", ctx.hostZIndex)("width", ctx.hostWidth)("height", ctx.hostHeight)("position", ctx.hostPosition)("transform", ctx.hostTransform);
        ɵngcc0.ɵɵclassProp("overlay-shown", ctx.hostShown);
    } }, inputs: { properties: "properties" }, decls: 1, vars: 0, consts: [["ad-host", ""]], template: function OverlayContainerComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, OverlayContainerComponent_ng_template_0_Template, 0, 0, "ng-template", 0);
    } }, directives: [ɵngcc2.AdDirective], styles: ["[_nghost-%COMP%]{position:absolute;top:0;left:0}[_nghost-%COMP%]   .overlay-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:#000;opacity:0;z-index:1000;pointer-events:auto}"] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(OverlayContainerComponent, [{
        type: Component,
        args: [{
                selector: 'overlay',
                template: "<!--\n<div class=\"overlay-backdrop\" \n\t*ngIf=\"properties.overlayBackdrop\" \n\t(click)=\"onBackdropClick()\" \n\t[ngClass]=\"properties.backdropClass\"></div>\n-->\n<!--\n<div class=\"overlay-container\"\n\t[ngStyle]=\"containerStyles\" \n\t[ngClass]=\"properties.overlayClass\">\n\n\t<ng-template ad-host></ng-template>\n</div>\n-->\n\n<ng-template ad-host></ng-template>",
                styles: [":host{position:absolute;top:0;left:0}:host .overlay-backdrop{position:fixed;top:0;left:0;right:0;bottom:0;background-color:#000;opacity:0;z-index:1000;pointer-events:auto}"]
            }]
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: ɵngcc0.ElementRef }, { type: ɵngcc1.EventService }]; }, { hostOpacity: [{
            type: HostBinding,
            args: ['style.opacity']
        }], hostTransition: [{
            type: HostBinding,
            args: ['style.transition']
        }], hostZIndex: [{
            type: HostBinding,
            args: ['style.z-index']
        }], hostWidth: [{
            type: HostBinding,
            args: ['style.width']
        }], hostHeight: [{
            type: HostBinding,
            args: ['style.height']
        }], hostPosition: [{
            type: HostBinding,
            args: ['style.position']
        }], onClick: [{
            type: HostListener,
            args: ['document:click', ['$event']]
        }], transitionEnd: [{
            type: HostListener,
            args: ['transitionend', ['$event']]
        }], hostShown: [{
            type: HostBinding,
            args: ['class.overlay-shown']
        }], hostTransform: [{
            type: HostBinding,
            args: ['style.transform']
        }], adHost: [{
            type: ViewChild,
            args: [AdDirective, { static: true }]
        }], properties: [{
            type: Input
        }] }); })();
    return OverlayContainerComponent;
}());
export { OverlayContainerComponent };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3ZlcmxheS1jb250YWluZXIuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyJhbmd1bGFyLWdhbGxlcnkvbGliL292ZXJsYXkvb3ZlcmxheS1jb250YWluZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLHdCQUF3QixFQUM1RyxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7QUFTN0M7QUFDRyxJQWlGQyxtQ0FDWSx3QkFBa0QsRUFDbkQsVUFBc0IsRUFDckIsWUFBMEI7QUFDekMsUUFKRyxpQkFTQztBQUVMLFFBVmdCLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7QUFDbEUsUUFBZSxlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQ3JDLFFBQWdCLGlCQUFZLEdBQVosWUFBWSxDQUFjO0FBQUUsUUFsRmpDLG9CQUFlLEdBQVksSUFBSSxDQUFDO0FBQzFDLFFBQUcsZUFBVSxHQUFXLEVBQUUsQ0FBQztBQUMzQixRQUFHLGlCQUFZLEdBQVcsQ0FBQyxDQUFDO0FBRTdCLFFBK0VRLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQy9ELFVBQUMsS0FBSztBQUFLLFlBQ1AsS0FBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzlDLFFBQVcsQ0FBQyxDQUNKLENBQUM7QUFDVCxJQUFHLENBQUM7QUFFTCxJQWpGSSxzQkFBSSxrREFBVztBQUNsQixhQURHO0FBQWUsWUFDWCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDN0QsUUFBRyxDQUFDO0FBQ0gsYUFBRSxVQUFnQixLQUFLO0FBQ3ZCLFlBQU0sSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7QUFDakMsUUFBRyxDQUFDO0FBRUo7QUFBMkI7QUFDVCxPQU5kO0FBQ0osSUFLRyxzQkFBSSxxREFBYztBQUNyQixhQURHO0FBQWUsWUFDWCxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixHQUFDLEtBQUssQ0FBQztBQUNoRSxZQUFPLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsdUJBQXVCLENBQUM7QUFDN0QsWUFBTyxPQUFPLFVBQVUsR0FBRSxRQUFRLEdBQUcsS0FBSyxHQUFHLGNBQWMsR0FBRSxRQUFRLEdBQUcsS0FBSyxDQUFDO0FBQzlFLFFBQUcsQ0FBQztBQUVKO0FBQTJCO0FBQTRCLE9BRm5EO0FBRUwsSUFFSSxzQkFBSSxpREFBVTtBQUNqQixhQURHO0FBQWUsWUFDWCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO0FBQ3JDLFFBQUcsQ0FBQztBQUVKO0FBQTJCO0FBRTFCLE9BSkc7QUFFTCxJQUNJLHNCQUFJLGdEQUFTO0FBQ2hCLGFBREc7QUFBZSxZQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUM7QUFDM0MsUUFBRyxDQUFDO0FBQ0g7QUFBMkI7QUFFNUIsT0FISTtBQUNKLElBQ0csc0JBQUksaURBQVU7QUFDakIsYUFERztBQUFlLFlBQ1gsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQztBQUM1QyxRQUFHLENBQUM7QUFFSjtBQUEyQjtBQUNSLE9BSGY7QUFFTCxJQUNJLHNCQUFJLG1EQUFZO0FBQ25CLGFBREc7QUFBZSxZQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUM7QUFDdkMsUUFBRyxDQUFDO0FBRUo7QUFBMkI7QUFBNEIsT0FGbkQ7QUFFTCxJQUdJLDJDQUFPLEdBQVAsVUFBUSxLQUFLO0FBQ2YsUUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRTtBQUNsRSxZQUFXLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBQztBQUM5QixnQkFBZSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7QUFDbkMsYUFBWTtBQUNaLFNBQVE7QUFDUixJQUFHLENBQUM7QUFFSixJQUNHLGlEQUFhLEdBQWIsVUFBYyxLQUFLO0FBQ3RCLFFBQU8sSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsSUFBSSxTQUFTLEVBQUM7QUFDM0QsWUFBVyxPQUFPO0FBQ2xCLFNBQVE7QUFFVCxRQUFRLElBQUksS0FBSyxDQUFDLFlBQVksSUFBSSxTQUFTLEVBQUU7QUFDNUMsWUFBVyxPQUFPO0FBQ2xCLFNBQVE7QUFFVCxRQUFRLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtBQUMzQixZQUFXLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztBQUNsQyxZQUFXLGlDQUFpQztBQUM1QyxTQUFRO0FBQUUsYUFBSTtBQUNkLFlBQVcsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7QUFDakMsWUFBVyxrQ0FBa0M7QUFDN0MsU0FBUTtBQUNSLElBQUcsQ0FBQztBQUVKLElBQUcsc0JBQUksbURBQVk7QUFDbkIsYUFERztBQUFlLFlBQ1gsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBQztBQUNwQyxnQkFBVyxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQztBQUN4RCxhQUFRO0FBQ1IsUUFBRyxDQUFDO0FBRUo7QUFDVTtBQUE0QixPQUhsQztBQUVMLElBV0ksNENBQVEsR0FBUjtBQUNGLFFBREUsaUJBT0M7QUFFTCxRQVJRLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztBQUM1QixRQUFPLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUU5QixRQUFRLFVBQVUsQ0FBQztBQUNaLFlBQUssS0FBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7QUFDakMsUUFBTyxDQUFDLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsaUJBQWlCO0FBQzdDLElBQUcsQ0FBQztBQUVKLElBQUcsbURBQWUsR0FBZjtBQUFlLFFBQWYsaUJBSUM7QUFFTCxRQUxRLFVBQVUsQ0FBQztBQUNaLFlBQUssS0FBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7QUFDdkMsUUFBTyxDQUFDLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQzNCLElBQUcsQ0FBQztBQUVKLElBQUcsK0NBQVcsR0FBWDtBQUFlLFFBQ1gsSUFBSSxJQUFJLENBQUMsd0JBQXdCLEVBQUU7QUFDMUMsWUFBVyxJQUFJLENBQUMsd0JBQXdCLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDdkQsU0FBUTtBQUNSLElBQUcsQ0FBQztBQUVKLElBQUcsa0RBQWMsR0FBZDtBQUFlLFFBQ1gsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLEdBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxtQkFBbUIsR0FBQyxHQUFHLENBQUM7QUFDbEYsSUFBRyxDQUFDO0FBRUosSUFBRyx3REFBb0IsR0FBcEI7QUFBZSxRQUNYLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO0FBQzVCLFFBQU8sSUFBSSxDQUFDLGFBQWEsR0FBRyxpQkFBaUIsQ0FBQztBQUM5QyxJQUFHLENBQUM7QUFFSixJQUFHLGlEQUFhLEdBQWI7QUFBZSxRQUNYLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7QUFDcEMsUUFBTyxJQUFJLGdCQUFnQixHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyx1QkFBdUIsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDMUcsUUFBTyxJQUFJLGdCQUFnQixHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUM7QUFFNUQsUUFBUSxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUVqQyxRQUFRLElBQUksWUFBWSxHQUFHLGdCQUFnQixDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQzdFLFFBQU8sSUFBSSxtQkFBbUIsR0FBeUIsWUFBWSxDQUFDLFFBQVMsQ0FBQyxhQUFhLENBQUM7QUFFN0YsUUFBUSxhQUFhO0FBQ3BCLFFBQU8sbUJBQW1CLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQztBQUMvRCxRQUFPLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7QUFFbEUsUUFBUSxjQUFjO0FBQ3JCLFFBQU8sSUFBSSxPQUFPLElBQUksQ0FBQyxZQUFZLEtBQUssUUFBUSxFQUFFO0FBQ2xELFlBQVcsbUJBQW1CLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDaEUsU0FBUTtBQUNSLFFBQU8sSUFBSSxPQUFPLElBQUksQ0FBQyxZQUFZLEtBQUssUUFBUSxFQUFFO0FBQ2xELFlBQVcsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBUyxTQUFTO0FBQ3ZELGdCQUFlLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDNUQsWUFBVyxDQUFDLENBQUMsQ0FBQztBQUNmLFNBQVM7QUFFVCxRQUFRLGtCQUFrQjtBQUN6QixRQUE2QixZQUFZLENBQUMsUUFBUyxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7QUFDeEYsSUFBRyxDQUFDO0FBRUosSUFBRyxnREFBWSxHQUFaO0FBQWUsUUFDWCxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztBQUM1QixRQUFPLElBQUksQ0FBQyxhQUFhLEdBQUcsYUFBYSxHQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsbUJBQW1CLEdBQUMsR0FBRyxDQUFDO0FBQ2xGLElBQUcsQ0FBQztBQUVKLElBQUcsbURBQWUsR0FBZjtBQUFlLFFBQ1gsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7QUFDOUIsUUFBTyxJQUFJLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQztBQUN6QyxZQUFXLElBQUksRUFBRSxnQkFBZ0I7QUFDakMsU0FBUSxDQUFDLENBQUM7QUFDVixJQUFHLENBQUM7QUFFSixJQUFHLHNEQUFrQixHQUFsQixVQUFtQixLQUFLO0FBQzFCLFFBQU0sSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLE1BQU0sRUFBQztBQUNqQyxZQUFXLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztBQUMvQixTQUFRO0FBQ1IsSUFBRyxDQUFDO0FBRUw7QUFBdUUsZ0JBdEY3Qix3QkFBd0I7QUFDL0QsZ0JBQXdCLFVBQVU7QUFDbEMsZ0JBQTJCLFlBQVk7QUFDMUM7QUFBVyxJQS9FaUM7QUFBYyxRQUFyRCxTQUFTLENBQUMsV0FBVyxFQUFFLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBQyxDQUFDO0FBQUUsNkRBQW1CO0FBRS9ELElBQVk7QUFBYyxRQUF0QixLQUFLLEVBQUU7QUFBRSxpRUFBNkI7QUFFMUMsSUFDRztBQUFjLFFBRGIsV0FBVyxDQUFDLGVBQWUsQ0FBQztBQUNoQyxnRUFFSTtBQUNILElBS0U7QUFBYyxRQURiLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQztBQUNuQyxtRUFJSTtBQUVKLElBQW1DO0FBQWMsUUFBN0MsV0FBVyxDQUFDLGlCQUFpQixDQUFDO0FBQUUsb0VBQXFCO0FBQ3hELElBQ0U7QUFBYyxRQURiLFdBQVcsQ0FBQyxlQUFlLENBQUM7QUFDakMsK0RBRUs7QUFFSixJQUNHO0FBQWMsUUFEYixXQUFXLENBQUMsYUFBYSxDQUFDO0FBQy9CLDhEQUVLO0FBQ0gsSUFDRTtBQUFjLFFBRGIsV0FBVyxDQUFDLGNBQWMsQ0FBQztBQUNoQywrREFFSztBQUVKLElBQ0c7QUFBYyxRQURiLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQztBQUNsQyxpRUFFSztBQUVKLElBQXVDO0FBQWMsUUFBakQsV0FBVyxDQUFDLHFCQUFxQixDQUFDO0FBQUUsZ0VBQWtCO0FBRTFELElBQ0c7QUFBYyxRQURiLFlBQVksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzlDLDREQU1JO0FBRUosSUFDRztBQUFjLFFBRGIsWUFBWSxDQUFDLGVBQWUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzdDLGtFQWdCSTtLQTFFUSx5QkFBeUIseUJBTnJDLFNBQVMsQ0FBQyxlQUNQLFFBQVEsRUFBRSxTQUFTLGVBQ25COzswQkFBaUQ7Ozs7NkRBRXBELENBQUMsU0FFVyx5QkFBeUIsQ0F3S3JDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFDRDtBQUFFLElBREYsZ0NBQUM7QUFDQyxDQURELEFBeEtELElBd0tDOztBQXBMQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBU0EsQUFrRkEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFIQSxBQVNBLEFBUkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBbEZBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWlGQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBL0VBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUhBLEFBTUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFJQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFLQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQ0EsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFhQSxBQUFBLEFBQUEsQUFBQSxBQU9BLEFBTkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUlBLEFBSEEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFwRkEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBOUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBREEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBTUEsQUFEQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBS0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBREEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBR0EsQUFEQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFFQSxBQURBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUdBLEFBREEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQURBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQU9BLEFBR0EsQUFEQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFpQkEsQUExRUEsQUFBQSxBQU5BLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFFQSxBQUFBLEFBd0tBLEFBQUEsQUFBQSxBQUFBLEFBeEtBLEFBd0tBLEFBeEtBLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSG9zdEJpbmRpbmcsIEhvc3RMaXN0ZW5lciwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBJbnB1dCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRXZlbnRTZXJ2aWNlIH0gZnJvbSAnLi9ldmVudC5zZXJ2aWNlJztcbmltcG9ydCB7IEFkRGlyZWN0aXZlIH0gZnJvbSAnLi9hZC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgQ29tcG9uZW50UHJvcGVydGllcywgT3ZlcmxheVByb3BlcnRpZXMgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ292ZXJsYXknLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9vdmVybGF5LWNvbnRhaW5lci5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vb3ZlcmxheS1jb250YWluZXIuY29tcG9uZW50LnNhc3MnXVxufSlcblxuZXhwb3J0IGNsYXNzIE92ZXJsYXlDb250YWluZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgIHB1YmxpYyBpc0luaXRpYWw6IGJvb2xlYW47XG4gICAgZ2xvYmFsRXZlbnRzU3Vic2NyaXB0aW9uO1xuICAgIHB1YmxpYyBvdmVybGF5QmFja2Ryb3A6IGJvb2xlYW4gPSB0cnVlO1xuICAgIG1pblRpbWVvdXQ6IG51bWJlciA9IDMwO1xuICAgIF9ob3N0T3BhY2l0eTogbnVtYmVyID0gMDtcblxuICAgIEBWaWV3Q2hpbGQoQWREaXJlY3RpdmUsIHtzdGF0aWM6IHRydWV9KSBhZEhvc3Q6IEFkRGlyZWN0aXZlO1xuXG4gICAgQElucHV0KCkgcHJvcGVydGllczogT3ZlcmxheVByb3BlcnRpZXM7XG5cbiAgICBASG9zdEJpbmRpbmcoJ3N0eWxlLm9wYWNpdHknKVxuICAgIGdldCBob3N0T3BhY2l0eSgpe1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzLmZhZGVJbiA/IHRoaXMuX2hvc3RPcGFjaXR5IDogMTtcbiAgICB9XG4gICAgc2V0IGhvc3RPcGFjaXR5KHZhbHVlKXtcbiAgICAgICAgdGhpcy5faG9zdE9wYWNpdHkgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBASG9zdEJpbmRpbmcoJ3N0eWxlLnRyYW5zaXRpb24nKVxuICAgIGdldCBob3N0VHJhbnNpdGlvbigpe1xuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IHRoaXMucHJvcGVydGllcy5hbmltYXRpb25EdXJhdGlvbisnbXMgJztcbiAgICAgICAgY29uc3QgZXNpbmcgPSB0aGlzLnByb3BlcnRpZXMuYW5pbWF0aW9uVGltaW5nRnVuY3Rpb247XG4gICAgICAgIHJldHVybiAnb3BhY2l0eSAnKyBkdXJhdGlvbiArIGVzaW5nICsgJywgdHJhbnNmb3JtICcrIGR1cmF0aW9uICsgZXNpbmc7XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdzdHlsZS50cmFuc2Zvcm0nKSBob3N0VHJhbnNmb3JtOiBzdHJpbmc7XG4gICAgQEhvc3RCaW5kaW5nKCdzdHlsZS56LWluZGV4JykgXG4gICAgZ2V0IGhvc3RaSW5kZXgoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy56SW5kZXg7XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdzdHlsZS53aWR0aCcpIFxuICAgIGdldCBob3N0V2lkdGgoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy53cmFwcGVyV2lkdGg7XG4gICAgfVxuICAgIEBIb3N0QmluZGluZygnc3R5bGUuaGVpZ2h0JykgXG4gICAgZ2V0IGhvc3RIZWlnaHQoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydGllcy53cmFwcGVySGVpZ2h0O1xuICAgIH1cblxuICAgIEBIb3N0QmluZGluZygnc3R5bGUucG9zaXRpb24nKSBcbiAgICBnZXQgaG9zdFBvc2l0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMucG9zaXRpb247XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5vdmVybGF5LXNob3duJykgaG9zdFNob3duOiBib29sZWFuO1xuXG4gICAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6Y2xpY2snLCBbJyRldmVudCddKVxuICAgIG9uQ2xpY2soZXZlbnQpe1xuICAgICAgICBpZiAoIXRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmhvc3RTaG93bil7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZU92ZXJsYXkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCBbJyRldmVudCddKVxuICAgIHRyYW5zaXRpb25FbmQoZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT0gXCJvdmVybGF5XCIpe1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGV2ZW50LnByb3BlcnR5TmFtZSAhPSBcIm9wYWNpdHlcIikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaG9zdFNob3duKSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlT3ZlcmxheUVuZCgpO1xuICAgICAgICAgICAgLy90aGlzLnN0YXRlRXZlbnRzLmVtaXQoXCJzaG93blwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaG9zdFNob3duID0gdHJ1ZTtcbiAgICAgICAgICAgIC8vdGhpcy5zdGF0ZUV2ZW50cy5lbWl0KFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHBvcG92ZXJDbGFzcygpe1xuICAgICAgICBpZiAodGhpcy5wcm9wZXJ0aWVzLm1ldGFkYXRhKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXMubWV0YWRhdGEucG9wb3ZlckNsYXNzO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgICAgIHB1YmxpYyBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgICAgICBwcml2YXRlIGV2ZW50U2VydmljZTogRXZlbnRTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZ2xvYmFsRXZlbnRzU3Vic2NyaXB0aW9uID0gdGhpcy5ldmVudFNlcnZpY2UuZW1pdHRlci5zdWJzY3JpYmUoXG4gICAgICAgICAgICAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUdsb2JhbEV2ZW50cyhldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMubG9hZENvbXBvbmVudCgpO1xuICAgICAgICB0aGlzLmluaXRpYWxPdmVybGF5KCk7XG5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzSW5pdGlhbCA9IHRydWU7XG4gICAgICAgIH0sIHRoaXMubWluVGltZW91dCk7IC8vIE5vdGU6IG5vdCBnb29kXG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2hvd092ZXJsYXlBbmltYXRpb24oKTtcbiAgICAgICAgfSwgdGhpcy5taW5UaW1lb3V0KTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZ2xvYmFsRXZlbnRzU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmdsb2JhbEV2ZW50c1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdGlhbE92ZXJsYXkoKXtcbiAgICAgICAgdGhpcy5ob3N0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVkoJyt0aGlzLnByb3BlcnRpZXMuYW5pbWF0aW9uVHJhbnNsYXRlWSsnKSc7XG4gICAgfVxuXG4gICAgc2hvd092ZXJsYXlBbmltYXRpb24oKXtcbiAgICAgICAgdGhpcy5ob3N0T3BhY2l0eSA9IDE7XG4gICAgICAgIHRoaXMuaG9zdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKDBweCknO1xuICAgIH1cblxuICAgIGxvYWRDb21wb25lbnQoKSB7XG4gICAgICAgIGxldCBhZEl0ZW0gPSB0aGlzLnByb3BlcnRpZXM7XG4gICAgICAgIGxldCBjb21wb25lbnRGYWN0b3J5ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoYWRJdGVtLm1haW5Db21wb25lbnQpO1xuICAgICAgICBsZXQgdmlld0NvbnRhaW5lclJlZiA9IHRoaXMuYWRIb3N0LnZpZXdDb250YWluZXJSZWY7XG5cbiAgICAgICAgdmlld0NvbnRhaW5lclJlZi5jbGVhcigpO1xuXG4gICAgICAgIGxldCBjb21wb25lbnRSZWYgPSB2aWV3Q29udGFpbmVyUmVmLmNyZWF0ZUNvbXBvbmVudChjb21wb25lbnRGYWN0b3J5KTtcbiAgICAgICAgbGV0IGNvbXBvbmVudFJlZkVsZW1lbnQgPSAoPENvbXBvbmVudFByb3BlcnRpZXM+Y29tcG9uZW50UmVmLmxvY2F0aW9uKS5uYXRpdmVFbGVtZW50O1xuXG4gICAgICAgIC8vIFNldCBzdHlsZXNcbiAgICAgICAgY29tcG9uZW50UmVmRWxlbWVudC5zdHlsZS53aWR0aCA9IHRoaXMucHJvcGVydGllcy53aWR0aDtcbiAgICAgICAgY29tcG9uZW50UmVmRWxlbWVudC5zdHlsZS5oZWlnaHQgPSB0aGlzLnByb3BlcnRpZXMuaGVpZ2h0O1xuXG4gICAgICAgIC8vIFNldCBjbGFzc2VzXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5wb3BvdmVyQ2xhc3MgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBjb21wb25lbnRSZWZFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5wb3BvdmVyQ2xhc3MpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5wb3BvdmVyQ2xhc3MgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aGlzLnBvcG92ZXJDbGFzcy5mb3JFYWNoKGZ1bmN0aW9uKGNsYXNzTmFtZSkge1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudFJlZkVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICAgICAgICAgICAgfSk7IFxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUGFzcyBwcm9wZXJ0aWVzXG4gICAgICAgICg8Q29tcG9uZW50UHJvcGVydGllcz5jb21wb25lbnRSZWYuaW5zdGFuY2UpLm92ZXJsYXlQcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzO1xuICAgIH1cblxuICAgIGNsb3NlT3ZlcmxheSgpe1xuICAgICAgICB0aGlzLmhvc3RPcGFjaXR5ID0gMDtcbiAgICAgICAgdGhpcy5ob3N0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVkoJyt0aGlzLnByb3BlcnRpZXMuYW5pbWF0aW9uVHJhbnNsYXRlWSsnKSc7XG4gICAgfVxuXG4gICAgY2xvc2VPdmVybGF5RW5kKCkge1xuICAgICAgICB0aGlzLmhvc3RTaG93biA9IGZhbHNlO1xuICAgICAgICB0aGlzLmV2ZW50U2VydmljZS5lbWl0Q2hhbmdlRXZlbnQoe1xuICAgICAgICAgICAgdHlwZTogJ1tPdmVybGF5XSBIaWRlJ1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBoYW5kbGVHbG9iYWxFdmVudHMoZXZlbnQpe1xuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ0hpZGUnKXtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VPdmVybGF5KCk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=